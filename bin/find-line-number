#!/usr/bin/env bash

function validate-arguments() {
  if [[ -z "$1" ]]; then
    echo "A path to a JSON file is required." 1>&2
    exit 1
  fi

  if [[ -z "$2" ]]; then
    echo "A JSON dot-delimited path is required." 1>&2
    exit 1
  fi
}

#######################################
# Find line number for a JSON path
# Arguments:
#   JSON file
#   Dot-delimited path
# Outputs:
#   Writes line number to stdout
#######################################
function main() {
  validate-arguments "$@"

  local filepath=${1}
  local jsonpath=$(gsed -e 's/\($\|^\)/"/g' -e 's/\(\.\)/"."/g' <<< $2)
  local output=$(jq -r .$jsonpath $filepath)

  if [[ "$output" == null ]]; then
    echo "No value was found for the given path." 1>&2
    exit 1
  fi

  echo $(awk "/$output/ {print FNR}" $filepath)
}

main "$@"
